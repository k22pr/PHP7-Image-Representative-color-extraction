<html>
	<head>
		<title>Git Hub (PHP7-Representative-color-extraction) Sample Page.</title>
		<link rel="stylesheet" href="https://k22pr.github.io/TisBe-CSS-Theme/css/index.css">
		<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
		<style>
			.flash{animation-name: flash;animation-iteration-count: infinite;animation-duration: 3s;animation-direction: alternate;}
			@keyframes flash {
				0%   {opacity: 1;}
				100% {opacity: 0;}
			}
		</style>
	</head>
	<body>
		<article class="wac10 mw12 m-pt5 p10">
			<h2 class="center">이미지 대표색상 추출</h2>
			<div class="wac10 mw12 info center">
				이페이지는 PHP이미지 대표색상 추출 예제를 위한 페이지입니다.
			</div>
			<form class="upload w12">
				<div class="w12 center btn o blue radi10 p10 upload-body">
					<input type="file" name="upload" class="upload fake" accept="image/*">
					<div class="w12 h1 bdr0 ment" ment="이곳에 이미지를 드래그/첨부 해주세요.">이곳에 이미지를 드래그/첨부 해주세요.</div>
				</div>
			</div>
		</article>
		
		<article class="print wac10 mw12 mt10">
		
		</article>
		
		<article class="wac10 p10 mt10">
			<div class="w12 info red">
				이 기능는 상당히 느립니다. 이미지 업로드시 DB에 기록하여 사용하세요!<br>
				테스트 목적 외에 사용을 금지합니다.
			</div>
			<div class="w12 info">
				테스트 페이지에는 최대 2MB까지의 이미지만 첨부가 가능합니다.<br>
				임시로 만든 페이지 이기 때문에 동시 업로드시 다른 이미지가 나타날 수 있습니다.<br>
			</div>
			<div class="wac6 mt10">
				<a href="https://twitter.com/mko457" target="_black"><div class="wdd6 btn sky p10">제작자 트위터</div></a>
				<a href="https://github.com/k22pr/PHP7-Image-Representative-color-extraction"><div class="wdd6 btn black p10">GIt페이지 바로가기</div></a>
			</div>
			<div class="w12 tstone tright mt10">
				이 페이지는 <a href="https://k22pr.github.io/TisBe-CSS-Theme/">tisbe</a> 테스트 목적으로 제작되었습니다.
			</div>
		</article>
		
		<script>
			function UploadImage(form){
				$("div.ment").html("이미지를 업로드 중입니다...");
				$.ajax({
					url : 'https://core.an1.kr/module/PHP7-Image-Representative-color-extraction/docs/server.php',
					//url : './server.php',
					type : "POST",
					processData: false,
					contentType: false,
					cache : false,
					data : form,
					success : function(msg){
						$("article.print").html(msg);
						$("div.image-color").height($("img.source-image").outerHeight());
						$("div.ment").html($("div.ment").attr("ment"));
					}
				});
			}
			
			function handleFileUpload(files,obj){
				var max_size = 1024*1024*3;
				if(files.length > 1){
					alert("한장의 이미지만 첨부 가능합니다.");
					return false;
				}else if(files[0].size > max_size){
					alert("3MB 이하의 이미지만 첨부 가능합니다.");
					return false;
				}
				var fd = new FormData();
				fd.append('upload', files[0]);
				fd.append('url', obj.attr('url'));
				fd.append('type', obj.attr('type'));
				fd.append('no', obj.attr('no'));
				UploadImage(fd);
			}
			
			$(document).ready(function(){
				$(document).on("change","input.upload",function(){
					data = $("form.upload")[0];
					form = new FormData(data);
					UploadImage(form);
				});
			});
			
			$(document).on('drop', "div.upload-body", function (e) {
				 e.preventDefault();
				 var files = e.originalEvent.dataTransfer.files;
				 if(files[0] === undefined) return false;
				 //We need to send dropped files to Server
				 handleFileUpload(files,$(this));
			});
			
		</script>
	</body>
</html>